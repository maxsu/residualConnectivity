project(residualConnectivity)
set(MFILES getGraph.m)
set(MEXFILES crudeMCImpl.cpp)
add_custom_target(copyMatlabPackagePrivate ALL)

if(WIN32)
	foreach(BUILD_TYPE IN LISTS CMAKE_CONFIGURATION_TYPES)
		foreach(MFILE IN LISTS MFILES)
			add_custom_command(TARGET copyMatlabPackagePrivate COMMAND ${CMAKE_COMMAND} -E copy_if_different ${CMAKE_CURRENT_SOURCE_DIR}/${MFILE} ${CMAKE_BINARY_DIR}/matlabPackage/${BUILD_TYPE}/private)
		endforeach()
	endforeach()
else()
	foreach(MFILE IN LISTS MFILES)
		add_custom_command(TARGET copyMatlabPackagePrivate COMMAND ${CMAKE_COMMAND} -E copy_if_different ${CMAKE_CURRENT_SOURCE_DIR}/${MFILE} ${CMAKE_BINARY_DIR}/matlabPackage/private/)
	endforeach()
	#On linux matlab ships with its own libstdc++, which we don't necessarily want to pull in. So we find our own libstd (the matlab one is set using LD_LIBRARY_PATH, so we won't pick it up here)
	find_library(LIBSTD_FOR_MEX stdc++)
	foreach(MEXFILE IN LISTS MEXFILES)
		get_filename_component(MEXFILE_NAME "${MEXFILE}" NAME_WE)
		matlab_add_mex(NAME ${MEXFILE_NAME} SRC ${MEXFILE} convertGraph.cpp LINK_TO crudeMCLib)
	endforeach()
endif()
